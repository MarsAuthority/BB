import{ad as t,H as p,I as o,F as n,U as s,O as e,ae as c,X as l}from"./framework-d186cff1.js";const i={},u=n("h2",{id:"èƒŒæ™¯",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#èƒŒæ™¯","aria-hidden":"true"},"#"),s(" èƒŒæ™¯")],-1),r={href:"http://drops.wooyun.org/papers/1409",target:"_blank",rel:"noopener noreferrer"},d=n("p",null,"æ¨èé˜…è¯»ï¼š",-1),k={href:"http://joncave.co.uk/2013/03/dangers-of-type-coercion-and-remote-management/",target:"_blank",rel:"noopener noreferrer"},m={href:"https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-0166",target:"_blank",rel:"noopener noreferrer"},v=n("h2",{id:"åˆ©ç”¨",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#åˆ©ç”¨","aria-hidden":"true"},"#"),s(" åˆ©ç”¨")],-1),h=n("p",null,"å…·ä½“çš„åŸç†è¯·çœ‹ä¸Šé¢è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸å¤šé‡å¤äº†ã€‚",-1),b=n("p",null,"ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªè¦æŠŠcookiesè®¾ç½®æˆ â€œadmin|$expiration|0â€,å°±å¯ä»¥ç™»é™†åå°äº†ã€‚",-1),_=n("p",null,"æ€è·¯æ˜¯ï¼š",-1),f=n("li",null,"1.å°è¯•$expirationæ„é€ Cookie",-1),g={href:"http://www.example.com/wp-admin/profile.php",target:"_blank",rel:"noopener noreferrer"},w=n("li",null,"3.å¤šçº¿ç¨‹,æœ‰æ¡ä»¶ä½¿ç”¨å¤šæœºå™¨",-1),y=c(`<h2 id="é¢˜å¤–è¯" tabindex="-1"><a class="header-anchor" href="#é¢˜å¤–è¯" aria-hidden="true">#</a> é¢˜å¤–è¯</h2><p>åœ¨å†™åˆ©ç”¨è„šæœ¬çš„æ—¶å€™å‘ç°ï¼Œpythonçš„urllib2.urlopenä¼šé‡åˆ°301/302è‡ªåŠ¨è·³è½¬çš„é—®é¢˜ï¼Œè¿™æ ·æ— æ³•åˆ¤æ–­å‡ºhttpçŠ¶æ€ç æ˜¯å¦æ˜¯302ã€‚æ¥åˆ†æçœ‹çœ‹ä¸ºä»€ä¹ˆå§ã€‚ğŸ˜ƒ</p><p>æ‰“å¼€urllib2æºç ï¼Œåˆšå¼€å¤´å°±çœ‹åˆ°äº†ç›¸å…³æ–‡æ¡£ï¼š</p><p><code>The HTTPRedirectHandler automatically deals with HTTP 301, 302, 303 and 307 redirect errors.</code></p><p>ä»”ç»†é˜…è¯»æºç çœ‹ä¸€ä¸‹è°ƒç”¨è¿‡ç¨‹ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#è°ƒç”¨urlopençš„æ–‡ä»¶</span>
response <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token comment">#urllib2.py ,line 127, in urlopen</span>
<span class="token keyword">return</span> _opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>
<span class="token comment">#urllib2.py ,line 410, in open</span>
response <span class="token operator">=</span> meth<span class="token punctuation">(</span>req<span class="token punctuation">,</span> response<span class="token punctuation">)</span>
<span class="token comment">#urllib2.py ,line 523, in http_response</span>
response <span class="token operator">=</span> self<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>error<span class="token punctuation">(</span>
                <span class="token string">&#39;http&#39;</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> code<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> hdrs<span class="token punctuation">)</span>
<span class="token comment">#urllib2.py ,line 442, in error</span>
result <span class="token operator">=</span> self<span class="token punctuation">.</span>_call_chain<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
<span class="token comment">#urllib2.py ,line 382, in _call_chain</span>
result <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
<span class="token comment">#urllib2.py ,line 608, in http_error_302</span>
new <span class="token operator">=</span> self<span class="token punctuation">.</span>redirect_request<span class="token punctuation">(</span>req<span class="token punctuation">,</span> fp<span class="token punctuation">,</span> code<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> newurl<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ°è¿™é‡Œæˆ‘æƒ³å·²ç»å¤Ÿæ¸…æ¥šäº†(æ‰§è¡Œåˆ°äº†æˆ‘ä»¬ä¹‹å‰åœ¨æ–‡æ¡£çœ‹åˆ°çš„HTTPRedirectHandler)ï¼Œæœ€åçš„redirect_requestï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">redirect_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> req<span class="token punctuation">,</span> fp<span class="token punctuation">,</span> code<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> newurl<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Return a Request or None in response to a redirect.

    This is called by the http_error_30x methods when a
    redirection response is received.  If a redirection should
    take place, return a new Request to allow http_error_30x to
    perform the redirect.  Otherwise, raise HTTPError if no-one
    else should try to handle this url.  Return None if you can&#39;t
    but another Handler might.
    &quot;&quot;&quot;</span>
    m <span class="token operator">=</span> req<span class="token punctuation">.</span>get_method<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">,</span> <span class="token number">302</span><span class="token punctuation">,</span> <span class="token number">303</span><span class="token punctuation">,</span> <span class="token number">307</span><span class="token punctuation">)</span> <span class="token keyword">and</span> m <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;HEAD&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">or</span> code <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">,</span> <span class="token number">302</span><span class="token punctuation">,</span> <span class="token number">303</span><span class="token punctuation">)</span> <span class="token keyword">and</span> m <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Strictly (according to RFC 2616), 301 or 302 in response</span>
        <span class="token comment"># to a POST MUST NOT cause a redirection without confirmation</span>
        <span class="token comment"># from the user (of urllib2, in this case).  In practice,</span>
        <span class="token comment"># essentially all clients do redirect in this case, so we</span>
        <span class="token comment"># do the same.</span>
        <span class="token comment"># be conciliant with URIs containing a space</span>
        newurl <span class="token operator">=</span> newurl<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;%20&#39;</span><span class="token punctuation">)</span>
        newheaders <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token keyword">if</span> k<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">&quot;content-length&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;content-type&quot;</span><span class="token punctuation">)</span>
                         <span class="token punctuation">)</span>
        <span class="token keyword">return</span> Request<span class="token punctuation">(</span>newurl<span class="token punctuation">,</span>
                       headers<span class="token operator">=</span>newheaders<span class="token punctuation">,</span>
                       origin_req_host<span class="token operator">=</span>req<span class="token punctuation">.</span>get_origin_req_host<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                       unverifiable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPError<span class="token punctuation">(</span>req<span class="token punctuation">.</span>get_full_url<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> fp<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥GETé‡åˆ°çŠ¶æ€ç ï¼ˆ301, 302, 303, 307ï¼‰æ—¶ä¼šRequestè·³è½¬åˆ°æ–°çš„åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•è·å–è¿™äº›çŠ¶æ€ç (æ²¡æœ‰ä¿å­˜ä¸‹æ¥)ã€‚</p><p>æˆ‘ä»¬éœ€è¦è‡ªå·±å†™ä¸€ä¸ªhanderæ¥é‡å†™30xæ–¹æ³•å¤„ç†è¿™ç§æƒ…å†µï¼Œä¿å­˜çŠ¶æ€ç ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#-*- coding:utf-8 -*-</span>
<span class="token keyword">import</span> urllib2
<span class="token comment">#è‡ªå®šä¹‰hander</span>
<span class="token keyword">class</span> <span class="token class-name">SmartRedirectHandler</span><span class="token punctuation">(</span>urllib2<span class="token punctuation">.</span>HTTPRedirectHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">http_error_301</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> req<span class="token punctuation">,</span> fp<span class="token punctuation">,</span> code<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">:</span>
		result <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>HTTPRedirectHandler<span class="token punctuation">.</span>http_error_301<span class="token punctuation">(</span>self<span class="token punctuation">,</span> req<span class="token punctuation">,</span> fp<span class="token punctuation">,</span> code<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> headers<span class="token punctuation">)</span>  
		result<span class="token punctuation">.</span>status <span class="token operator">=</span> code
		<span class="token keyword">return</span> result  
	<span class="token keyword">def</span> <span class="token function">http_error_302</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> req<span class="token punctuation">,</span> fp<span class="token punctuation">,</span> code<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">:</span>
		result <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>HTTPRedirectHandler<span class="token punctuation">.</span>http_error_302<span class="token punctuation">(</span>self<span class="token punctuation">,</span> req<span class="token punctuation">,</span> fp<span class="token punctuation">,</span> code<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> headers<span class="token punctuation">)</span>
		result<span class="token punctuation">.</span>status <span class="token operator">=</span> code
		<span class="token keyword">return</span> result

request <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>Request<span class="token punctuation">(</span><span class="token string">&quot;http://www.example.com/wp-admin/profile.php&quot;</span><span class="token punctuation">)</span> 
opener <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>SmartRedirectHandler<span class="token punctuation">)</span>
urllib2<span class="token punctuation">.</span>install_opener<span class="token punctuation">(</span>opener<span class="token punctuation">)</span>
response <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token keyword">print</span> response<span class="token punctuation">.</span>status
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå°±å¯ä»¥æ­£å¸¸è¿”å›301/302çŠ¶æ€ç ã€‚</p>`,12),q={href:"http://drops.wooyun.org/papers/1404",target:"_blank",rel:"noopener noreferrer"};function T(x,H){const a=l("ExternalLinkIcon");return p(),o("div",null,[u,n("p",null,[s("é¦–å…ˆçœ‹è¿™ç¯‡æ–‡ç« ï¼šWordPress 3.8.2 cookieä¼ªé€ æ¼æ´å†åˆ†æ "),n("a",r,[s("http://drops.wooyun.org/papers/1409"),e(a)])]),d,n("p",null,[n("a",k,[s("The dangers of type coercion and remote management plugins"),e(a)])]),n("p",null,[s("WordPress 3.8.2ä¿®å¤çš„ä¸€ä¸ªé‡è¦æ¼æ´æ˜¯cookieä¼ªé€ æ¼æ´Â "),n("a",m,[s("(CVE-2014-0166)"),e(a)]),s("ã€‚è¯¥æ¼æ´å¯ä»¥è¢«æ”»å‡»è€…åˆ©ç”¨é€šè¿‡ä¼ªé€ èº«ä»½éªŒè¯Cookieï¼Œç™»é™†ç½‘ç«™ã€‚")]),v,h,b,_,n("ul",null,[f,n("li",null,[s("2.GETè¯·æ±‚åˆ°"),n("a",g,[s("http://www.example.com/wp-admin/profile.php"),e(a)]),s(",æ ¹æ®è¿”å›çš„http headeråˆ¤æ–­æ˜¯å¦è·³è½¬,å¦‚ä¸º200åˆ™æˆåŠŸ")]),w]),y,n("p",null,[s("å¦å¤–ï¼ŒWordPress 3.8.2è¡¥ä¸åˆ†æ HMAC timing attackÂ "),n("a",q,[s("http://drops.wooyun.org/papers/1404"),e(a)]),s("Â æ€è·¯ç¡®å®å¾ˆèµã€‚")])])}const R=t(i,[["render",T],["__file","WordPress 3.8.2 cookieä¼ªé€ æ¼æ´åŠPythonä½¿ç”¨urllib2å‡ºç°30xè·³è½¬çš„é—®é¢˜.html.vue"]]);export{R as default};
